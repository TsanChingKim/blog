# 设备管理页面逻辑模型图

## 实体关系图 (ERD)

```mermaid
erDiagram
    SCHOOL {
        int school_id PK
        string school_name
        string address
        datetime created_at
        datetime updated_at
    }
    
    GRADE {
        int grade_id PK
        int school_id FK
        string grade_name
        int grade_level
        datetime created_at
        datetime updated_at
    }
    
    CLASS {
        int class_id PK
        int grade_id FK
        string class_name
        string classroom_location
        datetime created_at
        datetime updated_at
    }
    
    DEVICE {
        int device_id PK
        int class_id FK
        string device_number
        string installation_location
        string device_type
        string status
        datetime last_online_time
        datetime created_at
        datetime updated_at
    }
    
    USER {
        int user_id PK
        string username
        string password
        string role
        datetime created_at
        datetime updated_at
    }
    
    SCHOOL ||--o{ GRADE : "has"
    GRADE ||--o{ CLASS : "contains"
    CLASS ||--o{ DEVICE : "installs"
    USER ||--o{ SCHOOL : "manages"
```

## 页面功能流程图

```mermaid
flowchart TD
    A[设备管理页面] --> B[搜索筛选区域]
    A --> C[操作按钮区域]
    A --> D[数据表格区域]
    
    B --> B1[学校选择]
    B --> B2[年级输入]
    B --> B3[班级输入]
    B --> B4[状态选择]
    B --> B5[查询按钮]
    B --> B6[重置按钮]
    
    C --> C1[新增设备]
    C --> C2[批量删除]
    
    D --> D1[复选框列]
    D --> D2[序号列]
    D --> D3[学校名称列]
    D --> D4[年级列]
    D --> D5[班级列]
    D --> D6[设备安装位置列]
    D --> D7[设备编号列]
    D --> D8[状态列]
    D --> D9[操作列]
    
    D9 --> D9A[编辑按钮]
    D9 --> D9B[更多操作]
    
    D9B --> D9B1[删除]
    D9B --> D9B2[查看详情]
    D9B --> D9B3[设备配置]
```

## 数据状态流转图

```mermaid
stateDiagram-v2
    [*] --> 离线
    离线 --> 在线 : 设备上线
    在线 --> 离线 : 设备下线
    在线 --> 维护中 : 开始维护
    维护中 --> 在线 : 维护完成
    离线 --> 故障 : 检测到故障
    故障 --> 离线 : 故障修复
    故障 --> 报废 : 无法修复
    维护中 --> 报废 : 维护失败
    在线 --> 报废 : 设备老化
    报废 --> [*]
```

## 页面交互时序图

```mermaid
sequenceDiagram
    participant U as 用户
    participant P as 页面
    participant A as API接口
    participant D as 数据库
    
    U->>P: 打开设备管理页面
    P->>A: 请求设备列表
    A->>D: 查询设备数据
    D-->>A: 返回设备列表
    A-->>P: 返回设备数据
    P-->>U: 显示设备列表
    
    U->>P: 点击筛选条件
    P->>A: 发送筛选请求
    A->>D: 执行筛选查询
    D-->>A: 返回筛选结果
    A-->>P: 返回筛选数据
    P-->>U: 更新表格显示
    
    U->>P: 点击新增按钮
    P-->>U: 打开新增设备弹窗
    
    U->>P: 填写设备信息并提交
    P->>A: 发送新增请求
    A->>D: 插入设备数据
    D-->>A: 返回插入结果
    A-->>P: 返回操作结果
    P-->>U: 显示操作结果并刷新列表
```

## 核心业务逻辑

### 1. 数据层级关系
- **学校** → **年级** → **班级** → **设备**
- 每个层级都有明确的父子关系
- 设备必须归属于某个具体的班级

### 2. 筛选逻辑
- 支持按学校、年级、班级、状态进行筛选
- 筛选条件可以组合使用
- 支持重置所有筛选条件

### 3. 设备状态管理
- **在线**: 设备正常运行
- **离线**: 设备断开连接
- **维护中**: 设备正在维护
- **故障**: 设备出现故障
- **报废**: 设备已报废

### 4. 操作权限
- **查看**: 所有用户都可以查看设备列表
- **新增**: 管理员可以新增设备
- **编辑**: 管理员可以编辑设备信息
- **删除**: 管理员可以删除设备（单个或批量）

### 5. 数据验证规则
- 设备编号必须唯一
- 安装位置不能为空
- 设备必须关联到有效的班级
- 状态变更需要记录时间戳

## 业务线概念数据模型

### 1.1 设备新增业务线

```mermaid
flowchart LR
    A[登录] --> B[点击新增设备]
    B --> C[打开新增设备弹窗]
    C --> D[选择学校名称]
    D --> E[选择年级]
    E --> F[选择班级]
    F --> G[输入NVR]
    G --> H[输入安装位置]
    H --> I[选择设备类型]
    I --> J[输入用户名]
    J --> K[输入密码]
    K --> L{信息验证}
    L -->|验证通过| M[点击确定]
    L -->|验证失败| N[显示错误信息]
    N --> D
    M --> O{保存成功?}
    O -->|成功| P[显示成功信息]
    O -->|失败| Q[显示失败信息]
    P --> R[关闭弹窗]
    Q --> D
    R --> S[刷新设备列表]
    S --> T[注销]
    
    C --> U[点击取消]
    U --> V[关闭弹窗]
    V --> W[返回设备列表]
    W --> T
```

### 1.2 设备查询业务线

```mermaid
flowchart LR
    A[登录] --> B[设置筛选条件]
    B --> C[学校选择]
    C --> D[年级输入]
    D --> E[班级输入]
    E --> F[状态选择]
    F --> G[执行查询]
    G --> H{查询成功?}
    H -->|成功| I[显示设备列表]
    H -->|失败| J[显示错误信息]
    I --> K[用户操作]
    J --> B
    K --> L{选择操作}
    L -->|编辑| M[编辑设备]
    L -->|删除| N[删除设备]
    L -->|重置| B
    M --> O[注销]
    N --> O
```

### 1.3 设备编辑业务线

```mermaid
flowchart LR
    A[登录] --> B[选择设备]
    B --> C[点击编辑]
    C --> D[加载设备信息]
    D --> E{加载成功?}
    E -->|成功| F[显示编辑表单]
    E -->|失败| G[显示错误信息]
    F --> H[修改设备信息]
    G --> B
    H --> I{信息验证}
    I -->|验证通过| J[保存修改]
    I -->|验证失败| K[显示验证错误]
    J --> L{保存成功?}
    K --> H
    L -->|成功| M[显示成功信息]
    L -->|失败| N[显示失败信息]
    M --> O[刷新设备列表]
    N --> H
    O --> P[注销]
```

### 1.4 设备批量删除业务线

```mermaid
flowchart LR
    A[登录] --> B[选择多个设备]
    B --> C[点击批量删除]
    C --> D[显示确认对话框]
    D --> E{用户确认?}
    E -->|确认| F[执行批量删除]
    E -->|取消| G[返回设备列表]
    F --> H{删除成功?}
    G --> I[注销]
    H -->|成功| J[显示删除成功]
    H -->|失败| K[显示删除失败]
    J --> L[刷新设备列表]
    K --> M[显示失败详情]
    L --> N[注销]
    M --> N
```

### 1.5 设备状态监控业务线

```mermaid
flowchart LR
    A[登录] --> B[查看设备列表]
    B --> C[设备状态检查]
    C --> D{设备在线?}
    D -->|在线| E[更新在线状态]
    D -->|离线| F[更新离线状态]
    E --> G[记录在线时间]
    F --> H[记录离线时间]
    G --> I[刷新状态显示]
    H --> I
    I --> J[定时检查]
    J --> C
    C --> K[注销]
```

### 1.6 设备维护管理业务线

```mermaid
flowchart LR
    A[登录] --> B[选择故障设备]
    B --> C[点击维护操作]
    C --> D[填写维护信息]
    D --> E[设置维护状态]
    E --> F{信息完整?}
    F -->|完整| G[保存维护记录]
    F -->|不完整| H[显示提示信息]
    G --> I{保存成功?}
    H --> D
    I -->|成功| J[更新设备状态]
    I -->|失败| K[显示保存失败]
    J --> L[发送维护通知]
    K --> D
    L --> M[记录维护日志]
    M --> N[刷新设备列表]
    N --> O[注销]
```

## 业务规则说明

### 设备新增规则
- **学校名称**: 必选，从下拉列表中选择
- **年级**: 必选，从下拉列表中选择
- **班级**: 必选，从下拉列表中选择
- **NVR**: 必填，输入NVR设备信息
- **安装位置**: 必填，输入设备具体安装位置
- **设备类型**: 必选，从下拉列表中选择
- **用户名**: 必填，输入设备登录用户名
- **密码**: 必填，输入设备登录密码
- 所有字段都有红色星号标识为必填项
- 验证失败时显示具体错误信息
- 支持取消操作，关闭弹窗返回列表

### 设备查询规则
- 支持多条件组合查询
- 查询结果按设备编号排序
- 分页显示，每页最多20条记录
- 支持导出查询结果

### 设备编辑规则
- 只能编辑非报废状态的设备
- 设备编号修改需要重新验证唯一性
- 状态变更需要记录操作人和操作时间
- 重要字段修改需要二次确认

### 批量删除规则
- 只能删除非在线状态的设备
- 删除前需要用户确认
- 删除操作不可逆
- 记录删除日志

### 状态监控规则
- 每5分钟检查一次设备状态
- 离线超过30分钟的设备标记为异常
- 状态变更实时推送给管理员
- 异常设备自动发送告警通知

### 维护管理规则
- 维护状态需要填写维护原因
- 维护完成后需要填写维护结果
- 维护记录永久保存
- 维护费用需要记录

## 技术实现建议

### 前端技术栈
- **框架**: Vue.js / React
- **UI组件**: Element UI / Ant Design
- **状态管理**: Vuex / Redux
- **HTTP客户端**: Axios

### 后端技术栈
- **框架**: Spring Boot
- **数据库**: MySQL
- **ORM**: MyBatis / JPA
- **缓存**: Redis

### 数据库设计要点
1. 建立合适的索引提高查询性能
2. 使用外键约束保证数据完整性
3. 添加软删除字段支持数据恢复
4. 记录操作日志便于审计追踪
